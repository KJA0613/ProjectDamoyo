<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bitschool.basic.PostMapper">
	<select id="listAll" resultType="BPostDTO">
		select * from post order by postNo desc
	</select>
	
	<select id="selectRange" resultType="BPostDTO" parameterType="BPageVO">
		select * from
			(select rownum as num, temp.* from
			(select * from post order by postNo desc) temp)
		where num between #{start} and #{end}
	</select>

	<insert id="insert" parameterType="BPostDTO">
		<selectKey keyProperty="postNo" resultType="int" order="BEFORE">
			select postNo.nextval from dual
		</selectKey>
		insert into post(postNo,postTitle,postContents,userId,boardName) values
		(#{postNo},#{postTitle},#{postContents},#{userId},'free board')
	</insert>
	
	<update id="updateCnt" parameterType="Integer">
		update post set postCount = postCount + 1 where postNo = #{postNo}
	</update>
	
	<select id="selectOne" parameterType="Integer" resultType="BPostDTO">
		select * from post where postNo = #{postNo}
	</select>
	
	<delete id="deleteOne" parameterType="Integer">
		delete from post where postNo = #{postNo}
	</delete>
	
	<update id="updateContents" parameterType="BPostDTO">
		update post set postTitle = #{postTitle}, postContents = #{postContents} where postNo = #{postNo}
	</update>
	
	<select id="selectSearch" resultType="BPostDTO" parameterType="BSearchVO">
		select * from
			(select rownum as num, temp.* from
			(select * from post where postTitle like '%'||#{query}||'%' or postContents = '%'||#{query}||'%') temp)
		 where num between #{vo.start} and #{vo.end}
		 order by num desc
	</select>
</mapper>
